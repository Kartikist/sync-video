<!DOCTYPE html>
<html>
  <head>
    <title>Sync YouTube Video</title>
  </head>
  <body>
    <input type="text" id="video-id" placeholder="Enter YouTube video ID"></input>
    <button id="sync-button">Create Sync Link</button>
    <br />
    <input type="text" id="sync-url" readonly></input>
    <br />
    <div id="player"></div>
    <script>
      const tag = document.createElement('script');
      tag.src = 'https://www.youtube.com/iframe_api';
      document.body.appendChild(tag);

      let player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '360',
          width: '640',
          videoId: '',
          events: {
            onReady: onPlayerReady,
          },
        });
      }

      function onPlayerReady(event) {
        document.querySelector('#sync-button').addEventListener('click', () => {
          const videoId = document.querySelector('#video-id').value;
          fetch('https://asia-south1-carbide-skyline-374506.cloudfunctions.net/node-func?videoId=' + videoId)
            .then(response => response.text())
            .then(timestamp => {
              const syncUrl = `https://www.youtube.com/watch_popup?v=${videoId}&t=${timestamp}`;
              document.querySelector('#sync-url').value = syncUrl;
            });
        });
        setInterval(function() {
            fetch('https://asia-south1-carbide-skyline-374506.cloudfunctions.net/node-func?t=' + player.getCurrentTime());
          }, 1000);
      }
    </script>
  </body>
</html>
